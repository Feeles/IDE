<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>HackforPlay Example</title>
    <script async type="text/javascript" src="h4p.js" onload="h4p()"></script>
    <link rel="shortcut icon" href="data:image/gif;base64,R0lGODlhQABAAPZ+AB9zGyB0HCN1HyV7GiZ8Gyh9HSl9HiR2ICV2ISZ3Iyp6Jit6Jyt/IS58KzB9LDJ/Li2AIi+BJDKDKDiGLjSAMTWBMjaBMzeCNDqHMDuENz2GOj+HPD6KNECHPEGMN0KNOUSOO0SKQUaLQ0eMREqNRkqOR0ySQ1KWSViaT1OTUFSUUVeWVFiXVlmXVlqYV1ucU16dVl+eV2GfWWCcXmGcXmihZmmhZ2qiZ2uiaHCmbnSrbXapdHescHirdnqsd3useHyteXyten2ue4KxgIy5hpO8kZfAkprBlZvClqHEn6TGoqbHpKfIpajJp6zMp6vKqqzLqq7MrK/NrbDOr7PRr7TQs7XQs7jUtLrVt7rUubvUur/XvsDYv8HYwMXaw8XbxMfcxsjdxcjcx8nexsreycveys3gzNPk0dTk1Nfn1dfm1tjm19zp3N7q3eLt4ubv5efw5ujw5+ry6evy6+/17vD17/D28PH28PX49fX59fv8+/z9/P39/f7+/v///6usrSH5BAEAAH8ALAAAAABAAEAAAAf+gH6Cg4SFhoeIiYqLjI2Oj5CRkpOUlZaXmJmam5ydnp+goaKjpKWmp6ipqqusra6vsLGys7S1hAC4ubohhm9DHQgKKU18p7rHALyEWgvILHibYyYFH3mGuFZu2ttucYRqBwAaUGxoRQkAPZpOBgMDEIe4ZIw3ABt1hGQHPph9RAMRJgwAEQ/AvEUPADAxtAbTHh0DJNDxQ4VHwYOKBAD48unfABSL5DGyAKDIJwzuYoQ0yGgHAARRPBFwJ2MlxkRwLuCaYWZTH3cDYNyRcwYRMl1BCsVpkYvElGKWjngACpSD0aO4khqyMiJXCTSWwoQBekJsmqvZuGmbiIhLClylB55cAlpTkUhJWSoACCDGEl2blOZkAEDDL03AlJIAcGB4QN1EdxXt0XPICwABjR9fvWlIT44GWw5VAUAhM+JEIgDgOFQDgA3TdlkqUoJrSqEluMBU2gP0xcq0ar0J2qNiL5AybbrUA/CjEhYjQBkguQIZazJCdlYcFUKZElWq1bEqG8RHiosGAirg4Gyrvfv38OPLn0+/vv37+PPr38+/v///kgQCADs=" />
    <style media="screen">
    body {
        margin: 0;
        padding: 0;
    }
    .h4p__app {
        position: absolute;
        padding: 0;
        margin: 0;
        left: 0;
        top: 0;
        width: 100vw;
        height: 100vh;
    }
    </style>
  </head>
  <body>

    <!-- Config of the app -->
    <div class="h4p__app" data-target=".example1"></div>

    <!-- Files as a <script> -->
    <script class="example1" name="main.js" data-type="text/javascript" is-entry-point is-opened type="hack">
<!--
import message from 'sub/message';


document.body.textContent = message;


-->
    </script>
    <script class="example1" name="sub/message.js" data-type="text/javascript" type="hack">
<!--
export default "It's fine! :-)";

-->
    </script>
    <script class="example1" name="feeles/codemirror.css" data-type="text/css" type="hack">
<!--
.CodeMirror {
	font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
	background-color: rgba(245, 245, 245, 1.0);
	/* Set 100% to Dark Mode */
	filter: invert(0%);
}

.CodeMirror .cm-tab:before {
	/* Set visible to show tabs */
	visibility: hidden;
	content: '••••';
	color: rgba(0, 0, 0, 0.1);
	border-left: 1px solid rgba(0, 0, 0, 0.1);
	position: absolute;
}

.CodeMirror-linenumber {
	color: rgba(153, 153, 153, 1.0);
}
-->
    </script>
    <script class="example1" name="snippets/sample.json" data-type="application/json" type="hack">
<!--
{
    ".source.js": {
        "if": {
            "prefix": "if",
            "body": `
if (1 === 1) {

}`,
            "description": "( ) の中の条件が正しいときだけ、{ } の中に入ります",
            "leftLabel": "if 文"
        }
    }
}
-->
    </script>
    <script class="example1" name="index.html" data-type="text/html" type="hack">
<!--
<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Start</title>
        <link rel="stylesheet" href="style.css">
        <script src="lib/interrupt.js"></script>
        <script src="main.js"></script>
    </head>
    <body>
        <h1>LOADING...</h1>
    </body>
</html>
-->
    </script>
    <script class="example1" name="style.css" data-type="text/css" type="hack">
<!--
body {
    background-color: white;
    margin: 0;
    padding: 0;
}
-->
    </script>
    <script class="example1" name="lib/interrupt.js" data-type="text/javascript" type="hack">
<!--
const a_href = false;
const img_src = false;
const audio_src = false;
const script_src = false;
const xhr_url = false;

// Hyper link
if (a_href) {
	const hrefLoader = (node, href, set) => {
		set(`javascript: feeles.replace('${href}');`);
	};
	interruptSetter(HTMLAnchorElement, 'href', hrefLoader);
}

// Image source
if (img_src) {
	interruptSetter(HTMLImageElement, 'src', resourceLoader);
}

// Audio source
if (audio_src) {
	interruptSetter(HTMLAudioElement, 'src', resourceLoader);
}

// Script source
if (script_src) {
	interruptSetter(HTMLScriptElement, 'src', resourceLoader);
}

// XHR open()
if (xhr_url) {
	interruptXHR(XMLHttpRequest);
}

/**
 * @param node: HTMLElement
 * @param src: String
 * @param set: Function
 */
function resourceLoader(node, src, set) {

	if (!isSameOrigin(src)) {
		set(src);
		return;
	}
	// If relative path:
	feeles.fetch(getFeelesName(src))
		.then(response => response.blob())
		.then((blob) => {
			const url = URL.createObjectURL(blob);
			const revokeHandler = () => {
				node.removeEventListener('load', revokeHandler);
				node.removeEventListener('error', revokeHandler);
				URL.revokeObjectURL(url);
			};
			node.addEventListener('load', revokeHandler);
			node.addEventListener('error', revokeHandler);

			set(url);
		});

}

/**
 * @param constructor: HTMLElement
 * @param attr: String
 * @param delegate: Function(
 *	 node: HTMLElement,
 *	 value: any,
 *	 set: Function
 * )
 */
function interruptSetter(constructor, attr, delegate) {

	const proto = constructor.prototype;
	const desc = Object.getOwnPropertyDescriptor(proto, attr);
	Object.defineProperty(proto, attr, {
		set: function(value) {
			delegate(this, value, desc.set.bind(this));
		}
	});

}

/**
 * @param constructor: XMLHttpRequest
 * @param attr: String
 * @param delegate: Function(
 *	 node: HTMLElement,
 *	 value: any,
 *	 set: Function
 * )
 */
function interruptXHR(constructor) {
	const {
		open,
		send
	} = constructor.prototype;

	Object.defineProperty(constructor.prototype, 'open', {
		value: interruptOpen,
	});

	function interruptOpen(_method, _url, _async = true, _user = '', _password = '') {
		if (_async === false) {
			throw new Error('feeles.XMLHttpRequest does not support synchronization requests.');
		}
		if (!isSameOrigin(_url)) {
			open.call(this, _method, _url, _async, _user, _password);
			return;
		}
		this.send = function(...sendArgs) {
			feeles.fetch(getFeelesName(_url))
				.then((response) => response.blob())
				.then((blob) => {
					const url = URL.createObjectURL(blob);

					const revokeHandler = () => {
						this.removeEventListener('load', revokeHandler);
						this.removeEventListener('error', revokeHandler);
						this.removeEventListener('abort', revokeHandler);
						URL.revokeObjectURL(url);
					};

					this.addEventListener('load', revokeHandler);
					this.addEventListener('error', revokeHandler);
					this.addEventListener('abort', revokeHandler);

					open.call(this, _method, url, _async, _user, _password);
					send.apply(this, sendArgs);
				});
		};
	}

}



const currentOrigin = getOrigin('');
const baseURL = (() => {
	const a = document.createElement('a');
	a.href = '';

	if (!a.href) {
		return '';
	}

	// 	If a.origin === "null" (e.g. Open in Blob URL), a.pathname doesn't work.
	if (a.origin === "null") {
		return 'http://fake.origin/';
	}

	const index = a.href.lastIndexOf('/');
	return a.href.substr(0, index + 1);
})();

/**
 * @param url: String
 * @return String
 */
function getFeelesName(url) {
	if (baseURL) {
		const fullPath = new URL(url, baseURL).href;
		return fullPath.substr(baseURL.length);
	}
	return url;
}

/**
 * @param url: String
 * @return Boolean
 */
function isSameOrigin(url) {
	return getOrigin(url) === currentOrigin;
}

/**
 * @param url: String
 * @return String
 */
function getOrigin(url) {
	const a = document.createElement('a');
	a.href = url;
	return a.origin;
}
-->
    </script>

  </body>
</html>
